<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>プロフィール設定</title>
<style>
body { font-family:sans-serif; padding:20px; }
input { display:block; margin-bottom:10px; width:300px; padding:5px; }
button { padding:5px 10px; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h2>プロフィール設定</h2>
<label>ユーザー名</label>
<input type="text" id="nameInput">
<label>アイコンURL</label>
<input type="text" id="photoInput" placeholder="https://example.com/image.png">
<button id="saveBtn">保存してチャットに戻る</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEMXXNqQ3U7ojoY9h94X2yeFCJgXNtTwA",
  authDomain: "chatapp-hassu.firebaseapp.com",
  databaseURL: "https://chatapp-hassu-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "chatapp-hassu",
  storageBucket: "chatapp-hassu.appspot.com",
  messagingSenderId: "8489684752",
  appId: "1:8489684752:web:8e3fee02ce385cbda11f95"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

let currentUser=null;
const nameInput=document.getElementById("nameInput");
const photoInput=document.getElementById("photoInput");
const saveBtn=document.getElementById("saveBtn");

auth.onAuthStateChanged(user=>{
  if(!user) location.href="index.html";
  currentUser=user;
  database.ref("users/"+user.uid).get().then(snap=>{
    if(snap.exists()){
      const u = snap.val();
      nameInput.value = u.displayName || "";
      photoInput.value = u.photoURL || "";
    }
  });
});

saveBtn.addEventListener("click", ()=>{
  const displayName = nameInput.value.trim() || "名無し";
  const photoURL = photoInput.value.trim();
  database.ref("users/"+currentUser.uid).update({ displayName, photoURL }).then(()=>{
    alert("プロフィールを更新しました！");
    location.href="chat.html";
  });
});
</script>
</body>
</html>
